<!doctype html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://unpkg.com/lightweight-charts@3.1.5/dist/lightweight-charts.standalone.production.js"></script>
    <style>
        html, body { margin:0; padding:0; width:100%; height:100%; background:#ffffff; }
        #wrap { width:100%; height:100%; background:#ffffff; }
    </style>
</head>
<body>
<div id="wrap"></div>

<script>
    const wrap = document.getElementById('wrap');

    const chart = LightweightCharts.createChart(wrap, {
      layout: { backgroundColor: '#ffffff', textColor: '#0b0f14' },
      grid: { vertLines: { color: '#c7d0d9' }, horzLines: { color: '#c7d0d9' } },
      rightPriceScale: { borderColor: '#c7d0d9' },
      timeScale: { borderColor: '#c7d0d9', rightOffset: 6 },
      crosshair: { mode: LightweightCharts.CrosshairMode.Normal },
    });

    const candleSeries = chart.addCandlestickSeries({
      upColor: '#ff4d4f',
      downColor: '#2f7cff',
      borderUpColor: '#ff4d4f',
      borderDownColor: '#2f7cff',
      wickUpColor: '#ff4d4f',
      wickDownColor: '#2f7cff',
    });

    const volumeSeries = chart.addHistogramSeries({
      priceFormat: { type: 'volume' },
      priceScaleId: '',
      scaleMargins: { top: 0.8, bottom: 0 },
    });

    window.addEventListener('resize', () => {
      chart.resize(wrap.clientWidth, wrap.clientHeight);
    });

    // Kotlin에서 호출할 함수들
    window.tvChart = {
      setData: function(candles, volumes) {
        candleSeries.setData(candles);
        volumeSeries.setData(volumes);
        chart.timeScale().fitContent();
      },
      update: function(candle, volume) {
        candleSeries.update(candle);
        volumeSeries.update(volume);
      }
    };
</script>
</body>
</html>
